# IoT System Architecture
## Communication Paradigms
- **Client/Server**: sources explicitly know the destination of their messages.
- **Publish/Subscribe**: sources publish to a logical channel; interested destinations subscribe (one-to-many, no explicit sessions).
- Typical IoT traffic flows:
    - **Asynchronous events** (uplink)
    - **Periodic or on-demand measurements** (uplink)
    - **Commands** from processing platforms (downlink)

---

## Properties of an IoT System
- **Trustworthiness**: availability, resilience, confidentiality, integrity, safety.
- **Architectural**: composability, modularity, heterogeneity, scalability, legacy support, shareability, unique identification.
- **Functional**: accuracy, auto-configuration, context-awareness, big data management, discoverability, real-time, self-description, compliance.

---

## Standard Reference Model
- **Physical Entity Domain (PED)**: monitored physical objects.
- **Sensing & Controlling Domain (SCD)**: sensors, actuators bridging physical ↔ cyber world.
- **Operations & Management Domain (OMD)**: OSS + BSS for provisioning, assurance, optimization.
- **Resource Access & Interchange Domain (RAID)**: service interfaces with access policies.
- **Application & Service Domain (ASD)**: end-user services via APIs or portals.
- **User Domain (UD)**: human/digital users via devices (PCs, smartphones, control panels, smart glasses)

![[Pasted image 20251001094808.png]]

---

## Network Architectures
- **One-level**: endpoints use full IP stack (e.g., cellular).
- **Two-level (1b)**: endpoints resource-constrained, gateway manages protocols (LPWA, Low Power Wide Area: LoRa, SigFox, NB-IoT). *Target of the course*
- **Two-level (1c)**: endpoints support TCP/IP, traffic managed by router (Ethernet/Wi-Fi)



---

## WANs
- TCP/IP networks, shared among users.
- Public by nature.
- **VPNs**: reserved bandwidth/security for defined groups, with private IP addressing
- Users outside of a group cannot communicate directly with users of the group.
- Use private IP addressing and private routing protocol instances.

---

## Topologies
- **Bus**: every nodes taps into a shared medium (CSMA/CD), collisions possible.
- **Ring**: token-based, eliminates collisions, requires token management.
- **Star**: master/slave, predictable, not scalable (master bottleneck).
- **Mesh**: full or partial, robust, private, many physical links

---

# Endpoints

## Sensors
- Devices detecting stimuli → electrical/processable output.
- Types: pressure, temperature, biometric, chemical, acoustic, optical, positioning, etc.
- Three classifications:
	- **Fixed**: stable, not moving like domotics
	- **Mobile**: always moving (GPS, wearables)
	- **Nomadic**: they move but then they stop somewhere else (portable medical devices, field sensors)
- **Active vs Passive** sensors
	- **Active**: need to run a current or send a signal to get a measurement (e.g., clocks, strain gauges, radar).
	- **Passive**: use the physical phenomenon itself (e.g., piezoaccelerometers, GPS, thermocouples).

### Actuators
- Output elements performing actions.
- **Digital**: on/off switching.
- **Analog**: continuous signals (e.g., motor speed control).

### Gateways
- Bridge sensors ↔ higher-level processing/cloud.
- Provide connectivity, data collection, filtering, storage, event processing, optional analytics

### Fog Nodes
- “Bring the cloud to the ground.”
- More powerful than gateways, allow **local analytics with lower latency**.

---

# Data plane functions
## Data acquisition and processing

- In order to get a digital signal from a sensor, we need to account for:
    
    - Sampling
    - Aliasing
    - Quantization
    - Saturation
    - Hysteresis and non-linearities
    - Calibration
    - Error propagation

---

### **Data acquisition and processing: Sampling**

- First, we sample: we take (regular) measurements over time, and represent the signal with those measurements.
- Nyquist theorem: if sampling is ≥ twice as fast as the signal, sampling has no errors.
- Example: If a signal is thought to have a maximum frequency between 1000 Hz and 4000 Hz, which of the following would be the most appropriate sample rate?
    - a. 500 Hz
    - b. 8000 Hz
    - c. 9000 Hz
    - d. 24000 Hz

### **Data acquisition and processing: Aliasing**
- If we do not sample “enough,” we have aliasing: patterns in the sampled version.
- A high frequency component in the frequency spectrum of a signal takes the identity of a lower frequency component in the same spectrum of the sampled signal.
- This falsely estimated signal will be indistinguishable from (i.e., be an "alias" to) another signal having that true lower frequency.
- There are tools to avoid this, but we need to know it is an issue.
- Example: aliasing in a sine wave.
![[Pasted image 20251007085600.png]]

### **Data acquisition and processing: Quantization**
- Digital values are finite: we cannot represent continuous values precisely!
- Quantization always introduces an error, which is the sensor’s natural error.
- More bits, better resolution (but more data)

![[Pasted image 20251007085902.png]]

### Data acquisition and processing: Saturation

- Sensors often have an upper limit, which is either physical or dictated by the maximum quantization level: in this case, we have saturation (all higher values are mapped to the same output)
- This is what happens when you take a picture with high exposure: all lighter points are bright white!
![[Pasted image 20251007090152.png]]

### Hysteresis
- Sometimes sensors takes a while to track the process because the **physical nature of the measurement is slow**
- Which means we have Hysteresis error when the delay of sensor measurements depends on the magnitude of the change.

- Example: When you apply pressure to a sensor and then release that pressure, the sensor’s output should in theory return you to the same value it started at before that specific pressure cycle. However, in reality, there are often small differences between the initial value and the final value after a pressure cycle.
	- From 0 to 100 bar
	- 0 bar → 0 V
	- 100 bar → 2500 V
	- 0 bar → 0.05 V
		- **0.02% / 1 bar hysteresis**

### Non-linearities
- Ideally, sensors should also have linear responses: in reality, there are often non-linear effects that we need to adjust for.

- Hard to predict

- Example: A linear sensor’s output will change by equal amounts for equal pressure changes across its entire range.
	- From 0 to 10 bar
	- 0 bar → 0 V
	- 10 bar → 5 V
	- 3 bar → 4.2 V (while I would have expected 3.75 V, according to the previous data).
		- **≤2% non-linearity of full scale**

### Calibration

- Sensors often require calibration to give proper results:
    - Bias is a constant error term in one direction.
    - Distortion is due to non-linearity.

- By measuring a series of known quantities, we can compensate for these issues (however, external factors such as temperature can throw off calibration!)
- Example: Using the data from the calibration sheet, we see that the deviations are all less than the maximum deviation allowed of 0.5%.


### Error propagation

- Calculations can change the error of a measurement, as the errors are also considered in the function you compute.
- Non-linear functions can have weird effects with measurement errors.
- Derivation (e.g., computing velocity from position measurements) is brittle: since the measurements are close together, noise can have a huge effect.
- Integration/averaging are robust (rely on many points, and noise is compensated).
- Example: Calculating heat index
    - Temperature sensor: measured (30°) with uncertainty ±0.5
    - Humidity sensor: measured (70%) with uncertainty ±2% (= 0.02)
    - Heat index = T + 0.33×RH−0.7 = 52.4
    - **Uncertainty with error propagation: 0.828 > (0.5 + 0.02)**

---

### External data communication
- Sensors data may need to be shared with external parties, such as other peer nodes at the edge, fog, and cloud levels.
- Messages exchanged between IoT nodes may be delivered using **push** or **pull** modes.
	- **Pull**: a message is explicitly requested from the source (server) by its recipient, an IoT client.
	- **Push**: the data source and the gateway send data when the specified conditions are met, such as arrival of the data sampling time mark, or exceeding of the measurement threshold.
- **Publish/subscribe system**: data sources “publish” data to a known place, and authorized clients can “subscribe” to data of interest and receive related messages.
	- Publishers do not need to know the identity or number of their receivers (subscribers), and the receivers do not need to know the identity or state of their publishers.

### how to share sensors’ data?

- Some processes (e.g., an electricity meter, a room thermostat) do not need to be sampled very often.
- If we only care about cumulative measures (how much electricity was consumed in total), we do not need frequent samples!
- On the other hand, faster processes need frequent samples, as process can change faster.
- Why don’t we transmit all the time?
- There are several reasons why we cannot transmit all the time, but we will concentrate on two of them in this first part of the course:
    - Limited bandwidth
    - Limited energy
- Each transmission (and, in fact, each activity the sensor performs) costs energy, as well as blocking the wireless channel for other transmissions

### some solutions to send sensors’ data more efficiently

- **Interpolation**
    - Interpolation is the mathematical tool to infer missing data from sparse samples. We have to make some assumptions on the nature of the process to be able to interpolate: if we have the correct model, we can send a lot fewer data samples!
    - Interpolation can also be dangerous: we can underfit (select a model that is too simple) or overfit (select a model that is too complex and ends up following random noise).
![[Pasted image 20251007093806.png]]

- **Spatial correlation**
	- Data are usually correlated in space:
	    - Traffic on either side of a bridge.
	    - Temperatures close together.
	- There can be easy natural relations (points close together are similar) or structural relations (connected points are similar).
	- Since measurements have errors, correlations help us improving the quality of estimates: we can make statistical calculations and estimates to figure out what is happening in points (like the purple one on the bridge) where we have no sensors, or refine our estimates.

- **Temporal correlation**
	- Data are also correlated in time:
	    - Traffic in one spot
	    - Temperature measured by one sensor
	- The relation here can be more or less complex, and depend on space as well (e.g., line at a traffic light), but we can also exploit this to get better data with fewer transmissions.
	- Correlations can be misleading and dangerous! When relying on statistical information to reconstruct missing data or make decisions, we need to be aware that random chance is always a possibility.

---

### Local control

- Provided in systems where latency is critical and/or edge autonomy is required.
- Local control enables the edge node to execute pre-defined control sequences when a specified condition occurs on some combination of local data.
- If This Then That: scenes where lights and heating/cooling are adjusted accordingly when users are leaving or approaching their homes.
- **Node-RED**: provides a graphical user interface to construct data flows with the functional processing modules and actuation output stages.
- In the extreme case of temperature, the script triggers the device shutdown.

![[Pasted image 20251007094532.png]]

### Data storage

- Data storage for the acquired data may be provided by the gateway.
- The existence of local storage provides the flexibility to conserve network bandwidth and to reduce the load on cloud resources by selectively reporting data that meet certain conditions.
	- **Semantic communication.**
	- Depending on the nature of the physical thing being measured, **only some of the data points may be of interest**. E.g., successive minor changes may be of little interest, but those that exceed a comfort guard band or change by a significant percentage or amount from prior readings are.
	- Qualifying readings may be defined as events and reported only when they occur, with raw readings stored in the local database should they be required for auditing or subsequent analysis.


### (Edge) analytics

- Edge analytics for the data may be provided by the gateway or the fog node.
- Proximity to data sources: low latency.
- Ability to process high-frequency data samples (at the rate of the sensor) → real-time.
- Conservation of network bandwidth by not sending data to the cloud.
- Can operate even in disconnected mode.
- Analytics generally require AI/ML models:
    - Insufficient computational resources at the edge.
    - No data aggregation of edge/local data.
- IoT systems should be implemented using design tools and practices that facilitate flexible allocation of functions (in tandem between edge and cloud).

### Analytics placement

- Optimal placement of data and processing functions is an age-old trade-off in distributed systems. 
- It is based on whether it is more cost-effective to move the data to the computation or to move the computation to the data, depending on:
    - Availability and cost of bandwidth
    - Latency requirements for time-critical operations
    - Local autonomy of operations, including disconnected mode
    - Security and data control or privacy concerns
    - Cost and complexity of managing distributed nodes with computing and storage
    - Available energy resources
    - Available computational capacity
    - …

---

# Control plane functions

- Fully functional gateways may be fairly sophisticated computational and communications nodes that host and execute a variety of services.
- They need to be properly secured and managed.
- Main control functionalities:
    - Fault management (troubleshooting, error logging, and recovery).
    - Remote monitoring, control, administration, and diagnostics.
    - Remote firmware and software updates.
    - Security updates.
    - Metering (network bandwidth and software usage) and supervision.
    - Provisioning and authentication.

---

### (Cyber)security

- The first step is to determine the security risk.
- Identify, quantify, and prioritize the risks for the system, and find a balance between costs and potential losses from residual risks.
- Model to quantify risk: vulnerability, threats, and impacts.
![[Pasted image 20251007095925.png]]

- **Vulnerabilities**: can originate from the design of the system architecture, technology, and protocols, but more often emerge in the implementation (e.g., coding flaws) and in the operation phases (e.g., configuration errors, use of weak credential, unparched devices, unexpert use, etc.).
    
- **Security measures for the diligent user**:
    - Partitioning the system into zones (characterized in terms of security levels).
    - Adopt effective authentication protocols, tailored to the different zones.
    - Provide cryptographic protection of data.
    - Install equipment from trusted providers.
    - Make and install frequent patches and workarounds (software updates).
    - …

- **Threat**: an IoT network is a possible point of attack if the endpoint is unguarded and is positioned in an easily reachable position.
	- **Eavesdropping**: learning confidential information.
	- **Traffic analysis**: learning data origin, destination, and length (not the content).
	- **Forgery**: building a fake message, pretending it was sent by someone else.
	- **Masquerade**: claiming to be someone else in a single message.
	- **Repudiation**: denying having sent or received a message.
	- **Profiling**: gathering information about a single user.
	- **Fingerprinting**: identifying the user associated with a message.
	- **Jamming**: causing interference to a communication.

- **Standards**: IoT-oriented and industry-specific standards have been developed for security.
![[Pasted image 20251007100557.png]]

---

### Provisioning and authentication
- **Provisioning**: the lifecycle of an endpoint begins with its provisioning in the network.
- It is the process of giving the endpoint the configuration data and the ability to present itself.
- **Authorization**: checking the rights of access to the network.
- **Application-level authentication**: used if the network is shared among applications.
- **Authentication**: verification of the identity (“I know your name, is it you?”).
- **Challenge-response protocol**: employs secret keys for verification.

![[Pasted image 20251007101013.png]]

